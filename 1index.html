<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–°–ª–æ–≤–∞—Ä–Ω—ã–π –°—É–≥—Ä–æ–±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #1a237e;
            color: white;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        canvas {
            display: block;
        }
        
        #stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #4CAF50;
            backdrop-filter: blur(10px);
            z-index: 100;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 18px;
            min-width: 200px;
        }
        
        .stat-value {
            color: #FFD700;
            font-weight: bold;
        }
        
        #wordOverlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            width: 90%;
            max-width: 600px;
            display: none;
            pointer-events: none;
        }
        
        #wordDisplay {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            min-height: 60px;
            letter-spacing: 3px;
            font-weight: bold;
            text-shadow: 
                3px 3px 0 #000,
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
            padding: 20px 40px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            border: 3px solid #4CAF50;
        }
        
        #feedback {
            font-size: 28px;
            text-align: center;
            min-height: 40px;
            margin: 15px 0;
            transition: all 0.3s;
            text-shadow: 2px 2px 0 #000;
        }
        
        .correct { 
            color: #4CAF50; 
            animation: float 0.5s ease-in-out;
        }
        
        .wrong { 
            color: #FF5252; 
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ú–û–ë–ò–õ–¨–ù–ê–Ø –ö–õ–ê–í–ò–ê–¢–£–†–ê */
        #mobileKeyboard {
            position: fixed;
            top: 10px;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #4CAF50;
            z-index: 300;
            display: none;
            padding: 8px 0;
            border-radius: 0 0 15px 15px;
        }
        
        .keyboard-title {
            text-align: center;
            font-size: 12px;
            color: #4CAF50;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 4px 0;
            padding: 0 5px;
        }
        
        .keyboard-key {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .keyboard-key:active {
            transform: scale(0.9);
            background: linear-gradient(45deg, #1976D2, #1565C0);
        }
        
        .keyboard-backspace {
            width: 70px;
            background: linear-gradient(45deg, #FF5252, #D32F2F);
            font-size: 14px;
        }
        
        #locationIndicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 15px;
            border: 2px solid #2196F3;
            font-size: 16px;
            color: #FFD700;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        #celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .celebration-text {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            color: #FFD700;
            text-shadow: 3px 3px 0 #000;
            animation: float 2s ease-in-out infinite;
        }
        
        #restartBtn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #4CAF50, #2E7D32);
            border: 3px solid white;
            border-radius: 25px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            min-width: 250px;
            text-align: center;
        }
        
        #restartBtn:active {
            transform: scale(0.95);
        }
        
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a237e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .loading-text {
            font-size: 24px;
            margin-top: 20px;
            color: white;
            text-align: center;
        }
        
        .loading-bar {
            width: 300px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            #stats {
                top: 10px;
                left: 10px;
                padding: 10px;
            }
            
            .stat-row {
                font-size: 16px;
                min-width: 180px;
            }
            
            #wordDisplay {
                font-size: 32px;
                padding: 15px 25px;
            }
            
            #locationIndicator {
                top: 60px; /* –°–º–µ—â–∞–µ–º –Ω–∏–∂–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã */
                right: 10px;
                font-size: 14px;
                padding: 8px 12px;
            }
            
            .celebration-text {
                font-size: 36px;
                padding: 0 20px;
            }
            
            #restartBtn {
                min-width: 200px;
                font-size: 18px;
                padding: 12px 24px;
            }
            
            .loading-bar {
                width: 250px;
            }
            
            /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
            @media (max-width: 360px) {
                .keyboard-key {
                    width: 28px;
                    height: 28px;
                    font-size: 14px;
                }
                
                .keyboard-backspace {
                    width: 60px;
                }
            }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <div style="font-size: 48px; color: #FFD700; margin-bottom: 20px;">‚ùÑÔ∏è –°–ª–æ–≤–∞—Ä–Ω—ã–π –°—É–≥—Ä–æ–± ‚ùÑÔ∏è</div>
        <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...</div>
        <div class="loading-bar">
            <div id="loadingFill" class="loading-fill" style="width: 0%"></div>
        </div>
    </div>
    
    <div id="gameContainer" style="display: none;">
        <canvas id="gameCanvas"></canvas>
        
        <div id="stats">
            <div class="stat-row">
                <span>–ñ–∏–∑–Ω–∏:</span>
                <span id="lives" class="stat-value">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
            </div>
            <div class="stat-row">
                <span>–°–ª–æ–≤–∞:</span>
                <span id="wordsCount" class="stat-value">0/25</span>
            </div>
        </div>
        
        <div id="locationIndicator">üèôÔ∏è –¶–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞</div>
        
        <div id="wordOverlay">
            <div id="wordDisplay"></div>
            <div id="feedback"></div>
        </div>
        
        <!-- –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–õ–ê–í–ò–ê–¢–£–†–ê –¢–û–õ–¨–ö–û –° –ì–õ–ê–°–ù–´–ú–ò -->
        <div id="mobileKeyboard">
            <div class="keyboard-title">–í–≤–µ–¥–∏—Ç–µ –≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤—ã:</div>
            <div class="keyboard-row">
                <div class="keyboard-key" data-letter="–∞">–ê</div>
                <div class="keyboard-key" data-letter="–µ">–ï</div>
                <div class="keyboard-key" data-letter="—ë">–Å</div>
                <div class="keyboard-key" data-letter="–∏">–ò</div>
                <div class="keyboard-key" data-letter="–æ">–û</div>
                <div class="keyboard-key" data-letter="—É">–£</div>
            </div>
            <div class="keyboard-row">
                <div class="keyboard-key" data-letter="—ã">–´</div>
                <div class="keyboard-key" data-letter="—ç">–≠</div>
                <div class="keyboard-key" data-letter="—é">–Æ</div>
                <div class="keyboard-key" data-letter="—è">–Ø</div>
                <div class="keyboard-key keyboard-backspace" data-letter="backspace">‚Üê –£–¥–∞–ª–∏—Ç—å</div>
            </div>
        </div>
        
        <div id="celebration">
            <div class="celebration-text" id="celebrationTitle">üéâ –í–°–ï –°–õ–û–í–ê –ò–ó–£–ß–ï–ù–´! üéâ</div>
            <div style="font-size: 24px; color: #4CAF50; margin-bottom: 40px; text-align: center; max-width: 80%;">
                –í—ã —Å—Ç–∞–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–º –º–∞—Å—Ç–µ—Ä–æ–º —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞!
            </div>
            <div id="restartBtn">üîÑ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</div>
        </div>
    </div>

    <script>
        // –°–ª–æ–≤–∞ –¥–ª—è –∏–≥—Ä—ã
        const WORDS = [
            { word: "–ª.–±.—Ä–∏–Ω—Ç", missing: [1, 3], correct: "–∞–∏", hint: "–∑–∞–ø—É—Ç–∞–Ω–Ω—ã–µ —Ö–æ–¥—ã" },
            { word: "–ª.–≥–µ–Ω–¥–∞", missing: [1], correct: "–µ", hint: "—Ä–∞—Å—Å–∫–∞–∑ –æ –≥–µ—Ä–æ–∏—á–µ—Å–∫–æ–º –ø—Ä–æ—à–ª–æ–º" },
            { word: "–ª.–≥–µ–Ω–¥–∞—Ä–Ω—ã–π", missing: [1], correct: "–µ", hint: "—Å—Ç–∞–≤—à–∏–π –ª–µ–≥–µ–Ω–¥–æ–π" },
            { word: "–ª.–ª–µ—è—Ç—å", missing: [1], correct: "–µ", hint: "–Ω–µ–∂–Ω–æ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è" },
            { word: "–ª.–±.—Ä–∞–ª", missing: [1, 3], correct: "–∏–µ", hint: "—Å—Ç–æ—Ä–æ–Ω–Ω–∏–∫ —Å–≤–æ–±–æ–¥—ã" },
            { word: "–ª.–±.—Ä–∞–ª—å–Ω—ã–π", missing: [1, 3], correct: "–∏–µ", hint: "—Å–≤–æ–±–æ–¥–Ω—ã–π, —Ç–µ—Ä–ø–∏–º—ã–π" },
            { word: "–º.–∂–æ—Ä", missing: [1], correct: "–∞", hint: "–º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ª–∞–¥, –≤—ã—Ä–∞–∂–∞—é—â–∏–π –±–æ–¥—Ä–æ–µ, —Ä–∞–¥–æ—Å—Ç–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ" },
            { word: "–º.–∂–æ—Ä–Ω—ã–π", missing: [1], correct: "–∞", hint: "–±–æ–¥—Ä—ã–π, —Ä–∞–¥–æ—Å—Ç–Ω—ã–π (–æ –º—É–∑—ã–∫–µ)" },
            { word: "–º.—Ç–µ—Ä–∏–∞–ª", missing: [1], correct: "–∞", hint: "–≤–µ—â–µ—Å—Ç–≤–æ, –∏—Å—Ö–æ–¥–Ω–∏–∫" },
            { word: "–º.—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π", missing: [1], correct: "–∞", hint: "–≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π, —Ä–µ–∞–ª—å–Ω—ã–π" },
            { word: "–º.—Ç–µ—Ä–∏–∞–ª–∏–∑–º", missing: [1], correct: "–∞", hint: "—Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" },
            { word: "–º.—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å", missing: [1], correct: "–∞", hint: "–≤–æ–ø–ª–æ—â–∞—Ç—å –≤ –∂–∏–∑–Ω—å" },
            { word: "–º–≥–Ω.–≤–µ–Ω–∏–µ", missing: [3], correct: "–æ", hint: "–æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏" },
            { word: "–º–≥–Ω.–≤–µ–Ω–Ω—ã–π", missing: [3], correct: "–æ", hint: "–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π" },
            { word: "–º.–Ω—Ç–∞–ª.—Ç–µ—Ç", missing: [1, 6], correct: "–µ–∏", hint: "—Å–∫–ª–∞–¥ —É–º–∞, –º—ã—à–ª–µ–Ω–∏—è" },
            { word: "–º.–Ω—Ç–∞–ª—å–Ω—ã–π", missing: [1], correct: "–µ", hint: "–æ—Ç–Ω–æ—Å—è—â–∏–π—Å—è –∫ —É–º—É" },
            { word: "–º.—Ä.–¥–∏–∞–Ω", missing: [1, 3], correct: "–µ–∏", hint: "–ª–∏–Ω–∏—è –¥–æ–ª–≥–æ—Ç—ã –Ω–∞ –≥–ª–æ–±—É—Å–µ" },
            { word: "–º.—Ä–æ–ø—Ä–∏—è—Ç–∏–µ", missing: [1], correct: "–µ", hint: "–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ" },
            { word: "–º.—Ç–∞—Ñ–æ—Ä–∞", missing: [1], correct: "–µ", hint: "–æ–±—Ä–∞–∑–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ" },
            { word: "–º.—Ç–∞—Ñ–æ—Ä–∏—á–µ—Å–∫–∏–π", missing: [1], correct: "–µ", hint: "–æ–±—Ä–∞–∑–Ω—ã–π, –∏–Ω–æ—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π" },
            { word: "–º.—Ö–∞–Ω–∏–∑–º", missing: [1], correct: "–µ", hint: "—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, —Å–∏—Å—Ç–µ–º–∞" },
            { word: "–º.—Ö–∞–Ω–∏—á–µ—Å–∫–∏–π", missing: [1], correct: "–µ", hint: "–¥–µ–π—Å—Ç–≤—É—é—â–∏–π –∫–∞–∫ –º–µ—Ö–∞–Ω–∏–∑–º" },
            { word: "–º.–Ω–µ—Ä–∞–ª", missing: [1], correct: "–∏", hint: "–ø—Ä–∏—Ä–æ–¥–Ω–æ–µ –Ω–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–µ –≤–µ—â–µ—Å—Ç–≤–æ" },
            { word: "–º.–Ω–µ—Ä–∞–ª—å–Ω—ã–π", missing: [1], correct: "–∏", hint: "—Å–æ–¥–µ—Ä–∂–∞—â–∏–π –º–∏–Ω–µ—Ä–∞–ª—ã" },
            { word: "–º.–Ω–æ—Ä", missing: [1], correct: "–∏", hint: "–º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ª–∞–¥, –≤—ã—Ä–∞–∂–∞—é—â–∏–π –≥—Ä—É—Å—Ç–Ω–æ–µ, –ø–µ—á–∞–ª—å–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ" },
            { word: "–º.–Ω–æ—Ä–Ω—ã–π", missing: [1], correct: "–∏", hint: "–≥—Ä—É—Å—Ç–Ω—ã–π, –ø–µ—á–∞–ª—å–Ω—ã–π" },
            { word: "–º.–Ω.–ª–∏—Ç", missing: [1, 3], correct: "–æ–æ", hint: "–µ–¥–∏–Ω–∞—è –∫–∞–º–µ–Ω–Ω–∞—è –≥–ª—ã–±–∞" },
            { word: "–º.–Ω.–ª–∏—Ç–Ω—ã–π", missing: [1, 3, 4], correct: "–æ–æ", hint: "—Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ" },
            { word: "–º.—Ä.—Ç–æ—Ä–∏–π", missing: [1, 3], correct: "–æ–∞", hint: "–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–µ—Ç" },
            { word: "–º.—Ç–∏–≤", missing: [1], correct: "–æ", hint: "–ø—Ä–∏—á–∏–Ω–∞, –ø–æ–±—É–∂–¥–µ–Ω–∏–µ –∫ –¥–µ–π—Å—Ç–≤–∏—é" },
            { word: "–º.—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å", missing: [1], correct: "–æ", hint: "–ø–æ–±—É–∂–¥–∞—Ç—å –∫ –¥–µ–π—Å—Ç–≤–∏—é" },
            { word: "–º.—Ç–∏–≤–∞—Ü–∏—è", missing: [1], correct: "–æ", hint: "–ø–æ–±—É–∂–¥–µ–Ω–∏–µ –∫ –¥–µ–π—Å—Ç–≤–∏—é" },
            { word: "–º.—Ç–µ–∂", missing: [1], correct: "—è", hint: "–≤–æ—Å—Å—Ç–∞–Ω–∏–µ, –±—É–Ω—Ç" },
            { word: "–º.—Ç–µ–∂–Ω—ã–π", missing: [1], correct: "—è", hint: "–º—è—Ç–µ–∂–Ω—ã–π, –±—É–Ω—Ç–∞—Ä—Å–∫–∏–π" }
        ];

        // –õ–æ–∫–∞—Ü–∏–∏ —Å —Ñ–æ–Ω–∞–º–∏
        const LOCATIONS = [
            { name: "üèôÔ∏è –¶–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞", bg: "winter_background.png" },
            { name: "üìö –®–∫–æ–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω", bg: "school_district.png" },
            { name: "üèõÔ∏è –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–≤–∞—Ä—Ç–∞–ª", bg: "historic_district.png" },
            { name: "üé≠ –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å", bg: "theater_square.png" },
            { name: "üè° –¢–∏—Ö–∏–π –ø–µ—Ä–µ—É–ª–æ–∫", bg: "quiet_alley.png" },
            { name: "üå≥ –ü–∞—Ä–∫–æ–≤–∞—è –∑–æ–Ω–∞", bg: "park_area.png" },
            { name: "üè´ –®–∫–æ–ª—å–Ω—ã–π –¥–≤–æ—Ä", bg: "school_yard.png" },
            { name: "üè¢ –û—Ñ–∏—Å–Ω—ã–π –∫–≤–∞—Ä—Ç–∞–ª", bg: "office_district.png" },
            { name: "üè≠ –ó–∞–≤–æ–¥—Å–∫–∞—è —É–ª–∏—Ü–∞", bg: "factory_street.png" },
            { name: "üöß –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞", bg: "construction_site.png" }
        ];

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameActive = true;
        let lives = 3;
        let learnedWords = [];
        let currentWord = null;
        let currentSelection = [];
        let currentMissingIndex = 0;
        
        let player = { 
            x: 0, 
            y: 0, 
            width: 80, 
            height: 120, 
            direction: 'right',
            velocity: 0,
            maxSpeed: 8,
            acceleration: 0.5,
            friction: 0.9
        };
        
        let snowdrifts = [];
        let particles = [];
        let snowflakes = [];
        let currentLocation = 0;
        let cameraX = 0;
        const worldWidth = 4000;
        let gamePaused = false;

        // –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const images = {
            janitor_left: null,
            janitor_right: null,
            snowdrift: null,
            roof: null,
            backgrounds: []
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const loadingScreen = document.getElementById('loadingScreen');
        const loadingText = document.getElementById('loadingText');
        const loadingFill = document.getElementById('loadingFill');
        const gameContainer = document.getElementById('gameContainer');
        const livesElement = document.getElementById('lives');
        const wordsCountElement = document.getElementById('wordsCount');
        const locationIndicator = document.getElementById('locationIndicator');
        const wordOverlay = document.getElementById('wordOverlay');
        const wordDisplay = document.getElementById('wordDisplay');
        const feedbackElement = document.getElementById('feedback');
        const mobileKeyboard = document.getElementById('mobileKeyboard');
        const celebration = document.getElementById('celebration');
        const restartBtn = document.getElementById('restartBtn');
        const keyboardKeys = document.querySelectorAll('.keyboard-key');

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function loadImages() {
            const imageFiles = [
                { key: 'janitor_left', src: 'janitor_left.png' },
                { key: 'janitor_right', src: 'janitor_right.png' },
                { key: 'snowdrift', src: 'snowdrift.png' },
                { key: 'roof', src: 'roof.png' },
                ...LOCATIONS.map((loc, i) => ({ 
                    key: `bg_${i}`, 
                    src: loc.bg,
                    isBackground: true 
                }))
            ];

            let loadedCount = 0;
            const totalCount = imageFiles.length;

            imageFiles.forEach((file) => {
                const img = new Image();
                img.onload = () => {
                    if (file.isBackground) {
                        images.backgrounds.push(img);
                    } else {
                        images[file.key] = img;
                    }
                    loadedCount++;
                    
                    const progress = Math.round((loadedCount / totalCount) * 100);
                    loadingFill.style.width = `${progress}%`;
                    loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${loadedCount}/${totalCount} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`;
                    
                    if (loadedCount === totalCount) {
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            gameContainer.style.display = 'block';
                            initGame();
                        }, 500);
                    }
                };
                
                img.onerror = () => {
                    console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: ${file.src}`);
                    // –°–æ–∑–¥–∞–µ–º placeholder
                    const canvas = document.createElement('canvas');
                    if (file.key.includes('janitor')) {
                        canvas.width = 80;
                        canvas.height = 120;
                        const ctx = canvas.getContext('2d');
                        
                        // Placeholder –¥–ª—è –¥–≤–æ—Ä–Ω–∏–∫–∞
                        ctx.fillStyle = file.key.includes('left') ? '#FF5722' : '#FF9800';
                        ctx.fillRect(0, 0, 80, 120);
                        
                        // –ì–æ–ª–æ–≤–∞
                        ctx.fillStyle = '#FFCCBC';
                        ctx.beginPath();
                        ctx.arc(40, 40, 25, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // –¢–µ–ª–æ
                        ctx.fillStyle = '#3F51B5';
                        ctx.fillRect(20, 70, 40, 40);
                    } else if (file.key === 'snowdrift') {
                        canvas.width = 70;
                        canvas.height = 50;
                        const ctx = canvas.getContext('2d');
                        
                        // Placeholder –¥–ª—è —Å—É–≥—Ä–æ–±–∞
                        ctx.fillStyle = '#FFFFFF';
                        ctx.beginPath();
                        ctx.ellipse(35, 25, 35, 25, 0, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (file.isBackground) {
                        canvas.width = 800;
                        canvas.height = 600;
                        const ctx = canvas.getContext('2d');
                        
                        // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                        const gradient = ctx.createLinearGradient(0, 0, 0, 600);
                        gradient.addColorStop(0, '#1a237e');
                        gradient.addColorStop(1, '#0d47a1');
                        ctx.fillStyle = gradient;
                        ctx.fillRect(0, 0, 800, 600);
                    }
                    
                    if (file.isBackground) {
                        images.backgrounds.push(canvas);
                    } else {
                        images[file.key] = canvas;
                    }
                    
                    loadedCount++;
                    const progress = Math.round((loadedCount / totalCount) * 100);
                    loadingFill.style.width = `${progress}%`;
                    
                    if (loadedCount === totalCount) {
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            gameContainer.style.display = 'block';
                            initGame();
                        }, 500);
                    }
                };
                
                img.src = file.src;
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            gameActive = true;
            gamePaused = false;
            
            resizeCanvas();
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height - player.height - 50;
            cameraX = worldWidth / 2 - canvas.width / 2;
            
            // –°–±—Ä–æ—Å –∏–≥—Ä–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            lives = 3;
            learnedWords = [];
            snowdrifts = [];
            particles = [];
            snowflakes = [];
            currentLocation = 0;
            
            // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏
            initSnowflakes();
            
            // –°–æ–∑–¥–∞–µ–º —Å—É–≥—Ä–æ–±—ã
            createSnowdrifts();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–µ–∂–∏–Ω–æ–∫
        function initSnowflakes() {
            snowflakes = [];
            for (let i = 0; i < 100; i++) {
                snowflakes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 3 + 1,
                    speed: Math.random() * 2 + 1,
                    sway: Math.random() * 0.5,
                    opacity: 0.3 + Math.random() * 0.7
                });
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–≥—Ä–æ–±–æ–≤
        function createSnowdrifts() {
            snowdrifts = [];
            
            // –°–æ–∑–¥–∞–µ–º 8-10 —Å—É–≥—Ä–æ–±–æ–≤
            const count = 8 + Math.floor(Math.random() * 3);
            
            for (let i = 0; i < count; i++) {
                let x, validPosition, attempts = 0;
                
                do {
                    x = 100 + Math.random() * (worldWidth - 200);
                    validPosition = true;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –¥—Ä—É–≥–∏—Ö —Å—É–≥—Ä–æ–±–æ–≤
                    for (const snowdrift of snowdrifts) {
                        if (Math.abs(snowdrift.x - x) < 150) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    attempts++;
                    if (attempts > 100) {
                        x = 100 + i * 200;
                        break;
                    }
                } while (!validPosition);
                
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ
                const availableWords = WORDS.filter(word => !learnedWords.includes(word.word));
                const wordData = availableWords.length > 0 
                    ? availableWords[Math.floor(Math.random() * availableWords.length)]
                    : WORDS[Math.floor(Math.random() * WORDS.length)];
                
                const snowdrift = {
                    x: x,
                    y: canvas.height - 100,
                    width: 70,
                    height: 50,
                    word: wordData,
                    collected: false,
                    wobble: Math.random() * Math.PI * 2,
                    wobbleSpeed: 0.02 + Math.random() * 0.03,
                    wobbleAmount: 2 + Math.random() * 3
                };
                
                snowdrifts.push(snowdrift);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function updateGame() {
            if (!gameActive || gamePaused) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            updatePlayer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–º–µ—Ä—É
            updateCamera();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—É–≥—Ä–æ–±–æ–≤
            updateSnowdrifts();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Å—Ç–∏—Ü—ã
            updateParticles();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏
            updateSnowflakes();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ–Ω—É –ª–æ–∫–∞—Ü–∏–∏
            checkLocationChange();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        function updatePlayer() {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–µ–Ω–∏–µ
            player.velocity *= player.friction;
            
            // –ï—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∞—è, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
            if (Math.abs(player.velocity) < 0.1) {
                player.velocity = 0;
            }
            
            // –î–≤–∏–≥–∞–µ–º –∏–≥—Ä–æ–∫–∞
            player.x += player.velocity;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
            const worldPlayerX = cameraX + player.x;
            if (worldPlayerX < 50) {
                player.x = 50 - cameraX;
                player.velocity = 0;
            } else if (worldPlayerX > worldWidth - 50 - player.width) {
                player.x = worldWidth - 50 - player.width - cameraX;
                player.velocity = 0;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
        function updateCamera() {
            const targetCameraX = (cameraX + player.x) - canvas.width / 2;
            
            // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
            cameraX += (targetCameraX - cameraX) * 0.1;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
            cameraX = Math.max(0, Math.min(cameraX, worldWidth - canvas.width));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å—É–≥—Ä–æ–±–æ–≤
        function updateSnowdrifts() {
            snowdrifts.forEach(snowdrift => {
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏—è
                snowdrift.wobble += snowdrift.wobbleSpeed;
                const wobbleX = Math.sin(snowdrift.wobble) * snowdrift.wobbleAmount;
                
                // –ü–æ–∑–∏—Ü–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                snowdrift.screenX = snowdrift.x - cameraX + wobbleX;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –∏–≥—Ä–æ–∫–æ–º
                if (!snowdrift.collected && !gamePaused && !currentWord) {
                    if (checkCollision(player, {
                        x: snowdrift.screenX,
                        y: snowdrift.y,
                        width: snowdrift.width,
                        height: snowdrift.height
                    })) {
                        startWordGame(snowdrift);
                    }
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life -= 0.02;
                particle.vy += 0.1; // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
                
                if (particle.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–µ–∂–∏–Ω–∫–∏
        function updateSnowflakes() {
            snowflakes.forEach(flake => {
                flake.y += flake.speed;
                flake.x += Math.sin(flake.y * 0.01) * flake.sway;
                
                if (flake.y > canvas.height) {
                    flake.y = -10;
                    flake.x = Math.random() * canvas.width;
                }
                
                // –°–Ω–µ–∂–∏–Ω–∫–∏ –¥–≤–∏–∂—É—Ç—Å—è —Å –∫–∞–º–µ—Ä–æ–π
                flake.x -= player.velocity * 0.1;
                
                if (flake.x < -10) flake.x = canvas.width + 10;
                if (flake.x > canvas.width + 10) flake.x = -10;
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–Ω—ã –ª–æ–∫–∞—Ü–∏–∏
        function checkLocationChange() {
            const worldX = cameraX + player.x;
            const locationIndex = Math.floor((worldX / worldWidth) * LOCATIONS.length);
            
            if (locationIndex !== currentLocation) {
                currentLocation = Math.max(0, Math.min(locationIndex, LOCATIONS.length - 1));
                locationIndicator.textContent = LOCATIONS[currentLocation].name;
                
                // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–º–µ–Ω—ã –ª–æ–∫–∞—Ü–∏–∏
                createParticles('#2196F3', canvas.width/2, canvas.height/2, 30);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã —Å–æ —Å–ª–æ–≤–æ–º
        function startWordGame(snowdrift) {
            if (gamePaused || currentWord) return;
            
            currentWord = snowdrift.word;
            snowdrift.collected = true;
            currentSelection = new Array(currentWord.correct.length).fill(null);
            currentMissingIndex = 0;
            
            gamePaused = true;
            showWordOverlay();
            
            // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
            if (isMobile()) {
                mobileKeyboard.style.display = 'block';
                // –ü–æ–¥–Ω–∏–º–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ –≤—ã—à–µ, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª—Å—è
                locationIndicator.style.top = '80px';
            }
        }

        // –ü–æ–∫–∞–∑ —Å–ª–æ–≤–∞
        function showWordOverlay() {
            updateWordDisplay();
            wordOverlay.style.display = 'block';
        }

        // –°–∫—Ä—ã—Ç–∏–µ —Å–ª–æ–≤–∞
        function hideWordOverlay() {
            wordOverlay.style.display = 'none';
            feedbackElement.textContent = '';
            feedbackElement.className = '';
            currentWord = null;
            gamePaused = false;
            
            if (isMobile()) {
                mobileKeyboard.style.display = 'none';
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ –º–µ—Å—Ç–æ
                locationIndicator.style.top = '20px';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ–≤–∞
        function updateWordDisplay() {
            if (!currentWord) return;
            
            let display = '';
            let missingIndex = 0;
            
            for (let i = 0; i < currentWord.word.length; i++) {
                if (currentWord.missing.includes(i)) {
                    const userLetter = currentSelection[missingIndex];
                    if (userLetter) {
                        const correctLetter = currentWord.correct[missingIndex];
                        if (userLetter === correctLetter) {
                            display += `<span style="color: #4CAF50;">${userLetter}</span>`;
                        } else {
                            display += `<span style="color: #FF5252;">${userLetter}</span>`;
                        }
                    } else {
                        display += '<span style="color: #2196F3; border-bottom: 2px solid #2196F3;">_</span>';
                    }
                    missingIndex++;
                } else {
                    display += currentWord.word[i];
                }
            }
            
            wordDisplay.innerHTML = display;
        }

        // –í—ã–±–æ—Ä –±—É–∫–≤—ã
        function selectLetter(letter) {
            if (!currentWord || currentMissingIndex >= currentWord.correct.length || !gamePaused) return;
            
            currentSelection[currentMissingIndex] = letter;
            updateWordDisplay();
            
            const correctLetter = currentWord.correct[currentMissingIndex];
            const isCorrect = letter === correctLetter;
            
            if (isCorrect) {
                feedbackElement.textContent = '‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                feedbackElement.className = 'correct';
                
                // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü
                createParticles('#4CAF50', canvas.width/2, canvas.height/2, 15);
                
                currentMissingIndex++;
                
                if (currentMissingIndex >= currentWord.correct.length) {
                    completeWord(true);
                    return;
                }
            } else {
                feedbackElement.textContent = '‚úó –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
                feedbackElement.className = 'wrong';
                loseLife();
                
                // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü
                createParticles('#FF5252', canvas.width/2, canvas.height/2, 15);
                
                currentMissingIndex++;
                
                if (currentMissingIndex >= currentWord.correct.length) {
                    completeWord(false);
                    return;
                }
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–ª–æ–≤–∞
        function completeWord(isCorrect) {
            if (isCorrect) {
                if (!learnedWords.includes(currentWord.word)) {
                    learnedWords.push(currentWord.word);
                }
                
                // –≠—Ñ—Ñ–µ–∫—Ç —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è —Å—É–≥—Ä–æ–±–∞
                const snowdrift = snowdrifts.find(s => s.word === currentWord);
                if (snowdrift) {
                    explodeSnowdrift(snowdrift);
                    snowdrifts = snowdrifts.filter(s => s !== snowdrift);
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å—É–≥—Ä–æ–± —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
                    setTimeout(() => {
                        if (snowdrifts.length < 8) {
                            createNewSnowdrift();
                        }
                    }, 1000);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
                if (learnedWords.length >= 25) {
                    endGame(true);
                }
            }
            
            updateUI();
            
            setTimeout(() => {
                hideWordOverlay();
            }, 1000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—É–≥—Ä–æ–±–∞
        function createNewSnowdrift() {
            let x, validPosition, attempts = 0;
            
            do {
                x = 100 + Math.random() * (worldWidth - 200);
                validPosition = true;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –¥—Ä—É–≥–∏—Ö —Å—É–≥—Ä–æ–±–æ–≤
                for (const snowdrift of snowdrifts) {
                    if (Math.abs(snowdrift.x - x) < 150) {
                        validPosition = false;
                        break;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∏–≥—Ä–æ–∫–∞
                const playerWorldX = cameraX + player.x;
                if (Math.abs(playerWorldX - x) < 200) {
                    validPosition = false;
                }
                
                attempts++;
                if (attempts > 100) {
                    x = 100 + snowdrifts.length * 200;
                    break;
                }
            } while (!validPosition);
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ
            const availableWords = WORDS.filter(word => !learnedWords.includes(word.word));
            const wordData = availableWords.length > 0 
                ? availableWords[Math.floor(Math.random() * availableWords.length)]
                : WORDS[Math.floor(Math.random() * WORDS.length)];
            
            const snowdrift = {
                x: x,
                y: canvas.height - 100,
                width: 70,
                height: 50,
                word: wordData,
                collected: false,
                wobble: Math.random() * Math.PI * 2,
                wobbleSpeed: 0.02 + Math.random() * 0.03,
                wobbleAmount: 2 + Math.random() * 3
            };
            
            snowdrifts.push(snowdrift);
        }

        // –≠—Ñ—Ñ–µ–∫—Ç —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è —Å—É–≥—Ä–æ–±–∞
        function explodeSnowdrift(snowdrift) {
            const screenX = snowdrift.x - cameraX;
            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: screenX + snowdrift.width/2,
                    y: snowdrift.y + snowdrift.height/2,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8 - 4,
                    life: 1,
                    size: Math.random() * 3 + 2,
                    color: '#FFFFFF'
                });
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
        function createParticles(color, x, y, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 6,
                    vy: (Math.random() - 0.5) * 6 - 2,
                    life: 1,
                    size: Math.random() * 4 + 2,
                    color: color
                });
            }
        }

        // –ü–æ—Ç–µ—Ä—è –∂–∏–∑–Ω–∏
        function loseLife() {
            lives--;
            
            if (lives <= 0) {
                endGame(false);
            }
            
            updateUI();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –∂–∏–∑–Ω–∏
            createParticles('#FF5252', player.x + player.width/2, player.y + player.height/2, 20);
        }

        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function endGame(isVictory) {
            gameActive = false;
            gamePaused = true;
            
            if (isVictory) {
                document.getElementById('celebrationTitle').textContent = 'üéâ –í–°–ï –°–õ–û–í–ê –ò–ó–£–ß–ï–ù–´! üéâ';
            } else {
                document.getElementById('celebrationTitle').textContent = '‚ùÑÔ∏è –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê ‚ùÑÔ∏è';
            }
            
            celebration.style.display = 'flex';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
            mobileKeyboard.style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            livesElement.textContent = '‚ù§Ô∏è'.repeat(Math.max(0, lives));
            wordsCountElement.textContent = `${learnedWords.length}/25`;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
        function drawGame() {
            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Ñ–æ–Ω (–ø–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏)
            if (images.backgrounds[currentLocation]) {
                const bg = images.backgrounds[currentLocation];
                const pattern = ctx.createPattern(bg, 'repeat-x');
                ctx.fillStyle = pattern;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // –†–∏—Å—É–µ–º –¥–æ—Ä–æ–≥—É
            ctx.fillStyle = 'rgba(55, 71, 79, 0.9)';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            
            // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞
            ctx.strokeStyle = '#ffd600';
            ctx.lineWidth = 2;
            ctx.setLineDash([20, 15]);
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 25);
            ctx.lineTo(canvas.width, canvas.height - 25);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // –†–∏—Å—É–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏
            snowflakes.forEach(flake => {
                ctx.globalAlpha = flake.opacity;
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // –†–∏—Å—É–µ–º —á–∞—Å—Ç–∏—Ü—ã
            particles.forEach(particle => {
                ctx.globalAlpha = particle.life;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // –†–∏—Å—É–µ–º —Å—É–≥—Ä–æ–±—ã
            snowdrifts.forEach(snowdrift => {
                if (snowdrift.screenX && snowdrift.screenX > -100 && snowdrift.screenX < canvas.width + 100) {
                    if (images.snowdrift) {
                        ctx.drawImage(
                            images.snowdrift,
                            snowdrift.screenX,
                            snowdrift.y,
                            snowdrift.width,
                            snowdrift.height
                        );
                    } else {
                        // Placeholder
                        ctx.fillStyle = snowdrift.collected ? '#78909c' : '#FFFFFF';
                        ctx.beginPath();
                        ctx.ellipse(
                            snowdrift.screenX + snowdrift.width/2,
                            snowdrift.y + snowdrift.height/2,
                            snowdrift.width/2,
                            snowdrift.height/2,
                            0, 0, Math.PI * 2
                        );
                        ctx.fill();
                    }
                }
            });
            
            // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
            const playerImage = player.direction === 'left' ? images.janitor_left : images.janitor_right;
            if (playerImage) {
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ö–æ–¥—å–±—ã
                const walkOffset = Math.sin(Date.now() * 0.01) * 3;
                ctx.drawImage(
                    playerImage, 
                    player.x, 
                    player.y + walkOffset, 
                    player.width, 
                    player.height
                );
            } else {
                // Placeholder
                ctx.fillStyle = player.direction === 'left' ? '#FF5722' : '#FF9800';
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                // –ì–æ–ª–æ–≤–∞
                ctx.fillStyle = '#FFCCBC';
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + 40, 25, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // –†–∏—Å—É–µ–º –∫—Ä—ã—à—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (images.roof && Math.random() > 0.7) {
                ctx.globalAlpha = 0.8;
                ctx.drawImage(
                    images.roof,
                    canvas.width - 200,
                    canvas.height - 250,
                    200,
                    150
                );
                ctx.globalAlpha = 1;
            }
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            updateGame();
            drawGame();
            
            if (gameActive) {
                requestAnimationFrame(gameLoop);
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height - player.height - 50;
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
            initSnowflakes();
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–º
        let keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º
            if (gameActive && !gamePaused) {
                if (e.key === 'ArrowLeft' || e.key === 'a') {
                    player.direction = 'left';
                    player.velocity = Math.max(player.velocity - player.acceleration, -player.maxSpeed);
                } else if (e.key === 'ArrowRight' || e.key === 'd') {
                    player.direction = 'right';
                    player.velocity = Math.min(player.velocity + player.acceleration, player.maxSpeed);
                }
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–≤–æ–¥–æ–º –±—É–∫–≤
            if (currentWord && gamePaused) {
                const key = e.key.toLowerCase();
                const russianVowels = '–∞–µ—ë–∏–æ—É—ã—ç—é—è'; // –¢–æ–ª—å–∫–æ –≥–ª–∞—Å–Ω—ã–µ
                
                if (russianVowels.includes(key)) {
                    selectLetter(key);
                    e.preventDefault();
                } else if (e.key === 'Backspace') {
                    if (currentMissingIndex > 0) {
                        currentMissingIndex--;
                        currentSelection[currentMissingIndex] = null;
                        updateWordDisplay();
                    }
                    e.preventDefault();
                }
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        let touchStartX = 0;
        let touchStartTime = 0;
        
        canvas.addEventListener('touchstart', (e) => {
            if (!gameActive || gamePaused) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartTime = Date.now();
        });
        
        canvas.addEventListener('touchmove', (e) => {
            if (!gameActive || gamePaused) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartX;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
            if (Math.abs(deltaX) > 10) {
                player.direction = deltaX > 0 ? 'right' : 'left';
                player.velocity = Math.min(Math.max(deltaX * 0.2, -player.maxSpeed), player.maxSpeed);
                touchStartX = touch.clientX;
            }
        });
        
        canvas.addEventListener('touchend', (e) => {
            if (!gameActive || gamePaused) return;
            
            const touch = e.changedTouches[0];
            const touchTime = Date.now() - touchStartTime;
            
            // –ï—Å–ª–∏ –±—ã–ª–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ (–Ω–µ —Å–≤–∞–π–ø), –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Å–∞–Ω–∏–µ —Å—É–≥—Ä–æ–±–∞
            if (touchTime < 200) {
                checkTouchSnowdrift(touch.clientX, touch.clientY);
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∞–Ω–∏—è —Å—É–≥—Ä–æ–±–∞
        function checkTouchSnowdrift(touchX, touchY) {
            if (gamePaused || currentWord) return;
            
            for (const snowdrift of snowdrifts) {
                if (snowdrift.screenX && 
                    touchX > snowdrift.screenX && 
                    touchX < snowdrift.screenX + snowdrift.width &&
                    touchY > snowdrift.y && 
                    touchY < snowdrift.y + snowdrift.height &&
                    !snowdrift.collected) {
                    
                    startWordGame(snowdrift);
                    return;
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –º–æ–±–∏–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        keyboardKeys.forEach(key => {
            key.addEventListener('click', () => {
                const letter = key.getAttribute('data-letter');
                if (letter === 'backspace') {
                    if (currentMissingIndex > 0) {
                        currentMissingIndex--;
                        currentSelection[currentMissingIndex] = null;
                        updateWordDisplay();
                    }
                } else {
                    selectLetter(letter);
                }
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
        restartBtn.addEventListener('click', () => {
            celebration.style.display = 'none';
            initGame();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', resizeCanvas);

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        window.addEventListener('load', () => {
            loadImages();
        });
    </script>
</body>

</html>
